package com.itron.Kata;

import java.time.format.DateTimeFormatter;
import java.util.Scanner;

public class ClinicMain {

	private static ClinicCalendar calendar;

	public static void main(String[] args) {
		calendar = new ClinicCalendar();
		Scanner scanner = new Scanner(System.in);
		System.out.println("Welcome to the Patient Intake Computer System! \n\n");
		String lastOption = "";
		while (!lastOption.equalsIgnoreCase("x")) {
			lastOption = displayMenu(scanner);
		}
		System.out.println("\nExiting System..\n");
	}

	private static String displayMenu(Scanner scanner) {
		System.out.println("Please select an option:");
		System.out.println("1. Enter a Patient Appointment");
		System.out.println("2. View All Apointments");
		System.out.println("X. Exit System.");
		System.out.println("Option: ");
		String option = scanner.next();
		switch (option) {
		case "1":
			perfromPatienEntry(scanner);
			return option;
		case "2":
			perfromAppointments();
			return option;
		default:
			System.out.println("Invalid option, please re-enter. ");
			return option;
		}
	}

	private static void perfromPatienEntry(Scanner scanner) {
		scanner.nextLine();
		System.out.println("\n\nPlease Enter Appointment Info:");
		System.out.println(" Patient Last Name: ");
		String lastName = scanner.nextLine();
		System.out.println(" PAtient First Name: ");
		String firstName = scanner.nextLine();
		System.out.println("Appointment Date (M/d/yyyy h:m a): ");
		String when = scanner.nextLine();
		System.out.println(" Docktor Last Name: ");
		String doc = scanner.nextLine();
		try {
			calendar.addApointment(firstName, lastName, doc, when);
		} catch (Throwable t) {
			System.out.println("Error! " + t.getMessage());
		}
		System.out.println("Patient entered successfully.\n\n");
	}

	private static void perfromAppointments() {
		System.out.println("\n\n All Appointments in System: ");
		for (PatientAppointment appointment : calendar.getAppointments()) {
			DateTimeFormatter formatter = DateTimeFormatter.ofPattern("M/d/yyyy hh:mm a");
			String appTime = formatter.format(appointment.getAppointmentDateTime());
			System.out.println(String.format("%s: %s, %s\t\t Doctor: %s", appTime,
					appointment.getPatientLastName(), appointment.getPatientFirstName(),
					appointment.getDoctor().getName()));
		}
		System.out.println("\nPress any key to continue...");
	}

}
